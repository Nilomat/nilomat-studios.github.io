<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NI_CPU Decompiler</title>
<style>
  body { font-family: monospace; margin: 20px; background: #f0f0f0; }
  textarea { width: 100%; height: 100px; font-family: monospace; font-size: 14px; }
  button { margin: 10px 0; padding: 10px 15px; font-size: 16px; cursor: pointer; }
  pre { background: #222; color: #eee; padding: 15px; white-space: pre-wrap; min-height: 200px; }
</style>
</head>
<body>

<h1>NI_CPU Decompiler</h1>
<p>Enter machine code bytes as hex, separated by commas (e.g. <code>1B,1E,1F,1D,18,00,5D,7D</code>):</p>
<textarea id="inputBytes" placeholder="Enter hex bytes here..."></textarea>
<br />
<button onclick="decompile()">Decompile</button>

<h2>Assembly Output:</h2>
<pre id="outputAsm"></pre>

<script>
function decompile() {
  const input = document.getElementById("inputBytes").value.trim();
  if (!input) {
    alert("Please enter some machine code bytes.");
    return;
  }
  
  // Parse input hex bytes into array of integers
  const bytes = input.split(",").map(b => parseInt(b.trim(), 16));
  if (bytes.some(isNaN)) {
    alert("Invalid hex byte found.");
    return;
  }
  
  let i = 0;
  const lines = [];
  while (i < bytes.length) {
    const byte = bytes[i];
    switch(byte) {
      case 0x00:
        lines.push("noop");
        i++;
        break;
      case 0x1F:
        lines.push("set ar2");
        i++;
        break;
      case 0x1E:
        lines.push("set ar1");
        i++;
        break;
      case 0x1D:
      case 0x5D:
      case 0x7D:
      case 0x9D:
      case 0xBD:
      case 0xDD:
      case 0xFD:
        {
          const opMap = {
            0x1D: "add",
            0x5D: "sub",
            0x7D: "and",
            0x9D: "or",
			      0x3D: "comp",
            0xBD: "xor",
            0xDD: "ar2_gt_ar1",
            0xFD: "ar1_gt_ar2"
          };
          const opName = opMap[byte] || "unknown";
          lines.push(opName);
          i++;
        }
        break;
      case 0x1B: // von data nach zp (external data)
        lines.push("load ##");
        i++;
        break;
      case 0x1C:
        lines.push("set ram");
        i++;
        break;
      case 0x1A:
        lines.push("get ram");
        i++;
        break;
      case 0x19:
        lines.push("set ra");
        i++;
        break;
      case 0x18:
        lines.push("output");
        i++;
        break;
      case 0x17:
        lines.push("jumpzp");
        i++;
        break;
      case 0x16:
        lines.push("output2");
        i++;
        break;
      case 0x15:
        lines.push("get input");
        i++;
        break;
      case 0x14:
        lines.push("set zpe");
        i++;
        break;
      case 0x13:
        lines.push("get zpe");
        i++;
        break;
      case 0x12:
        lines.push("get count");
        i++;
        break;
      case 0x11:
        lines.push("set sr");
        i++;  
        break;
      case 0x10:
        lines.push("get sr");
        i++;    
        break;
      case 0x0f:
        lines.push("get input2");
        i++; 
        break; 
      case 0x0e:
        lines.push("get input3");
        i++;
        break;      
      case 0x0d:
        lines.push("get input4");
        i++;
        break;   
      case 0x0c:
        lines.push("output3");
        i++;   
        break;
      case 0x0b:
        lines.push("output4");
        i++; 
        break;
      default:
        lines.push(`Unknown opcode ${byte.toString(16).padStart(2,"0")}`);
        i++;
    }
  }
  
  document.getElementById("outputAsm").textContent = lines.join("\n");
}
</script>

</body>
</html>
